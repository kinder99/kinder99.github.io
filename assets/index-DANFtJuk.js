import{XRButton as G}from"https://unpkg.com/three@0.181.1/examples/jsm/webxr/XRButton.js";import"https://unpkg.com/three@0.181.1/examples/jsm/webxr/XRControllerModelFactory.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const a of t)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function r(t){const a={};return t.integrity&&(a.integrity=t.integrity),t.referrerPolicy&&(a.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?a.credentials="include":t.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(t){if(t.ep)return;t.ep=!0;const a=r(t);fetch(t.href,a)}})();class p{constructor(e,r,n,t){this.name=e,this.origin=r,this.u=n,this.v=t}viewMatrix(e){var r=this.u.clone().normalize(),n=this.v.clone().normalize(),t=new THREE.Vector3().crossVectors(r,n),a=new THREE.Vector3().subVectors(e,t),c=new THREE.Vector3(0,1,0),i=new THREE.Matrix4;i=i.lookAt(e,a,c);var v=new THREE.Matrix4().makeTranslation(-e.x,-e.y,-e.z);return i=i.multiplyMatrices(i,v),i}projectionMatrix(e,r,n){var t=this.u.clone().normalize(),a=this.v.clone().normalize(),c=this.origin.clone(),i=this.origin.clone().add(this.u),v=this.origin.clone().add(this.v);c.sub(e),i.sub(e),v.sub(e);var x=this.v.clone().cross(this.u).normalize(),f=c.dot(t),O=i.dot(t),C=c.dot(a),z=v.dot(a),h=c.dot(x),B=f*r/h,N=O*r/h,D=C*r/h,I=z*r/h,k=new THREE.Matrix4().makePerspective(B,N,I,D,r,n);return k}}var s,m,d,l,R,H,g,E,u,w,M=!0,y;let T;function F(){T=document.createElement("div"),document.body.appendChild(T),s=new THREE.WebGLRenderer({antialias:!0}),s.autoClear=!1,s.setSize(window.innerWidth,window.innerHeight),s.setPixelRatio(window.devicePixelRatio),s.setAnimationLoop(L),s.xr.enabled=!0,T.appendChild(s.domElement),T.appendChild(G.createButton(s)),X(),Z(),Y(),W(6.8),_(),q(),A(d,s),K(),L()}function P(){console.log("i am here"),y.scale.x+=event.deltaY/500,y.scale.y+=event.deltaY/500,y.scale.z+=event.deltaY/500}function K(){var o=[];o.push(m.getObjectByName("Teapot")),o.push(m.getObjectByName("Torus")),o.push(E.getObjectByName("Head")),w=new THREE.DragControls(o,d,s.domElement),w.addEventListener("hoveron",function(e){u.enabled=!1}),w.addEventListener("hoveroff",function(e){u.enabled=!0}),w.addEventListener("dragstart",function(e){e.object.material.emissive.set(11184810),y=e.object,window.addEventListener("wheel",P,!1)}),w.addEventListener("dragend",function(e){e.object.material.emissive.set(0),window.removeEventListener("wheel",P,!1)})}function W(e){var e=6.8;g=new THREE.Vector3(50,20,50);var r=new THREE.Vector3(-e/2,10,-6),n=new THREE.Vector3(+e/2,10,-6);E=new THREE.Scene;var a=new THREE.SphereGeometry(10,32,22),c=new THREE.MeshPhongMaterial({color:11184810}),t=new THREE.Mesh(a,c);t.name="Head",t.position.set(g.x,g.y,g.z),E.add(t);var a=new THREE.SphereGeometry(3,32,22),c=new THREE.MeshPhongMaterial({color:16711680}),i=new THREE.Mesh(a,c);i.name="EyeL",i.position.set(r.x,r.y,r.z),t.add(i);var a=new THREE.SphereGeometry(3,32,22),c=new THREE.MeshPhongMaterial({color:255}),i=new THREE.Mesh(a,c);i.name="EyeR",i.position.set(n.x,n.y,n.z),t.add(i),b(E)}function A(o,e){u=new THREE.OrbitControls(o,e.domElement),u.minDistance=120,u.maxDistance=5e4}function b(o){var e=new THREE.AmbientLight(8947848,.4);o.add(e);var r=new THREE.PointLight(16777215,.8);r.position.z+=200,o.add(r)}function _(){m=new THREE.Scene;var o=new THREE.TeapotGeometry(40,15),e=new THREE.MeshPhongMaterial({color:16777215}),r=new THREE.Mesh(o,e);r.name="Teapot",r.position.z-=70,m.add(r);var n=new THREE.TorusGeometry(10,3,15,100),t=new THREE.MeshPhongMaterial({color:16777215}),a=new THREE.Mesh(n,t);a.name="Torus",a.position.z-=-75,m.add(a),b(m)}function Y(){R=new THREE.Scene;for(var[o,e]of l.entries()){var r=e.origin,n=e.u,t=e.v,a=new THREE.BoxGeometry(n.length(),t.length(),.01),c=new THREE.MeshPhongMaterial({map:H[o].texture}),i=new THREE.Mesh(a,c);i.name=e.name,e.name=="Left"&&(i.rotation.y=Math.PI/2),e.name=="Right"&&(i.rotation.y=-Math.PI/2),e.name=="Floor"&&(i.rotation.x=Math.PI/2,i.rotation.z=Math.PI);var v=n.clone().multiplyScalar(.5),x=t.clone().multiplyScalar(.5),f=new THREE.Vector3().addVectors(r,v);f.add(x),i.position.set(f.x,f.y,f.z),R.add(i)}b(R)}function Z(){H=[];for(var e of l)H.push(new THREE.WebGLRenderTarget(1024,1024))}function q(){d=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e4),d.position.set(100,100,300),d.lookAt(0,0,0)}function X(){l=[];var o=new p("Front",new THREE.Vector3(-150,-150,-150),new THREE.Vector3(300,0,0),new THREE.Vector3(0,300,0));l.push(o);var e=new p("Left",new THREE.Vector3(-150,-150,150),new THREE.Vector3(0,0,-300),new THREE.Vector3(0,300,0));l.push(e);var r=new p("Right",new THREE.Vector3(150,-150,-150),new THREE.Vector3(0,0,300),new THREE.Vector3(0,300,0));l.push(r);var n=new p("Floor",new THREE.Vector3(-150,-150,150),new THREE.Vector3(300,0,0),new THREE.Vector3(0,0,-300));l.push(n)}function S(){var o=E.getObjectByName("EyeL");return o.getWorldPosition(new THREE.Vector3)}function j(){var o=E.getObjectByName("EyeR");return o.getWorldPosition(new THREE.Vector3)}function V(o,e){var r=d.clone(),n=new THREE.Matrix4;return n.copy(o).invert(),r.position.set(n.elements[12],n.elements[13],n.elements[14]),r.setRotationFromMatrix(o),r.projectionMatrix=e.clone(),r}function L(){var o=s.getContext(),e=s.xr.enabled;s.xr.enabled=!1,s.setClearColor(8421504),s.clear(),M&&s.render(m,d);for(let[i,v]of l.entries()){s.setRenderTarget(H[i]),s.setClearColor(4210752),s.clear(),o.colorMask(1,0,0,0);var n=S(),t=v.viewMatrix(n),a=v.projectionMatrix(n,1,1e4),r=V(t,a);s.render(m,r),o.colorMask(0,1,1,0);var n=j(),t=v.viewMatrix(n),a=v.projectionMatrix(n,1,1e4),c=V(t,a);s.clearDepth(),s.render(m,c),o.colorMask(1,1,1,0)}s.xr.enabled=e,s.setRenderTarget(null),s.setClearColor(0),s.render(R,d),s.render(E,d)}function J(o){var e=E.getObjectByName("Head"),r=E.getObjectByName("EyeL"),n=E.getObjectByName("EyeR");e.position,r.position.x-=o/2,n.position.x+=o/2}function Q(o){var e=E.getObjectByName("Head"),r=E.getObjectByName("EyeL"),n=E.getObjectByName("EyeR");e.position,r.position.x+=o/2,n.position.x-=o/2}window.addEventListener("keydown",function(o){switch(o.code){case"KeyL":var e=S();d.position.set(e.x,e.y,e.z);break;case"KeyR":var e=j();d.position.set(e.x,e.y,e.z);break;case"KeyS":M=!M;break;case"KeyT":var r=l[0].viewMatrix(new THREE.Vector3(50,20,100)),t=l[1].viewMatrix(new THREE.Vector3(50,20,100)),a=l[2].viewMatrix(new THREE.Vector3(50,20,100));console.log("View matrices:"),console.log(r),console.log(t),console.log(a);var n=l[0].projectionMatrix(new THREE.Vector3(0,0,0),1,1e3),t=l[1].viewMatrix(new THREE.Vector3(50,20,100)),a=l[2].viewMatrix(new THREE.Vector3(50,20,100));console.log("Projection matrices:"),console.log(n),console.log(t),console.log(a);break;case"KeyI":J(8);break;case"KeyO":Q(8);break}});F();
