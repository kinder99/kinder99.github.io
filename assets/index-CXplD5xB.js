import{XRButton as I}from"https://unpkg.com/three@0.181.1/examples/jsm/webxr/XRButton.js";import"https://unpkg.com/three@0.181.1/examples/jsm/webxr/XRControllerModelFactory.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const a of t)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function r(t){const a={};return t.integrity&&(a.integrity=t.integrity),t.referrerPolicy&&(a.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?a.credentials="include":t.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(t){if(t.ep)return;t.ep=!0;const a=r(t);fetch(t.href,a)}})();class h{constructor(e,r,n,t){this.name=e,this.origin=r,this.u=n,this.v=t}viewMatrix(e){var r=this.u.clone().normalize(),n=this.v.clone().normalize(),t=new THREE.Vector3().crossVectors(r,n),a=new THREE.Vector3().subVectors(e,t),c=new THREE.Vector3(0,1,0),i=new THREE.Matrix4;i=i.lookAt(e,a,c);var m=new THREE.Matrix4().makeTranslation(-e.x,-e.y,-e.z);return i=i.multiplyMatrices(i,m),i}projectionMatrix(e,r,n){var t=this.u.clone().normalize(),a=this.v.clone().normalize(),c=this.origin.clone(),i=this.origin.clone().add(this.u),m=this.origin.clone().add(this.v);c.sub(e),i.sub(e),m.sub(e);var y=this.v.clone().cross(this.u).normalize(),f=c.dot(t),S=i.dot(t),j=c.dot(a),O=m.dot(a),u=c.dot(y),C=f*r/u,z=S*r/u,B=j*r/u,D=O*r/u,N=new THREE.Matrix4().makePerspective(C,z,D,B,r,n);return N}}var s,d,v,l,R,p,g,E,w,H=!0,T;function b(){console.log("i am here"),T.scale.x+=event.deltaY/500,T.scale.y+=event.deltaY/500,T.scale.z+=event.deltaY/500}function k(){var o=[];o.push(d.getObjectByName("Teapot")),o.push(d.getObjectByName("Torus")),o.push(E.getObjectByName("Head"));var e=new THREE.DragControls(o,v,s.domElement);e.addEventListener("hoveron",function(r){w.enabled=!1}),e.addEventListener("hoveroff",function(r){w.enabled=!0}),e.addEventListener("dragstart",function(r){r.object.material.emissive.set(11184810),T=r.object,window.addEventListener("wheel",b,!1)}),e.addEventListener("dragend",function(r){r.object.material.emissive.set(0),window.removeEventListener("wheel",b,!1)})}function F(e){var e=6.8;g=new THREE.Vector3(50,20,50);var r=new THREE.Vector3(-e/2,10,-6),n=new THREE.Vector3(+e/2,10,-6);E=new THREE.Scene;var a=new THREE.SphereGeometry(10,32,22),c=new THREE.MeshPhongMaterial({color:11184810}),t=new THREE.Mesh(a,c);t.name="Head",t.position.set(g.x,g.y,g.z),E.add(t);var a=new THREE.SphereGeometry(3,32,22),c=new THREE.MeshPhongMaterial({color:16711680}),i=new THREE.Mesh(a,c);i.name="EyeL",i.position.set(r.x,r.y,r.z),t.add(i);var a=new THREE.SphereGeometry(3,32,22),c=new THREE.MeshPhongMaterial({color:255}),i=new THREE.Mesh(a,c);i.name="EyeR",i.position.set(n.x,n.y,n.z),t.add(i),x(E)}function G(){s=new THREE.WebGLRenderer({preserveDrawingBuffer:!0}),s.autoClear=!1,s.setSize(window.innerWidth,window.innerHeight),s.setPixelRatio(window.devicePixelRatio),s.xr.enabled=!0,s.xr.setReferenceSpaceType("local"),s.setAnimationLoop(M),document.body.appendChild(s.domElement),document.body.appendChild(I.createButton(s))}function K(o,e){w=new THREE.OrbitControls(o,e.domElement),w.minDistance=120,w.maxDistance=5e4}function x(o){var e=new THREE.AmbientLight(8947848,.4);o.add(e);var r=new THREE.PointLight(16777215,.8);r.position.z+=200,o.add(r)}function A(){d=new THREE.Scene;var o=new THREE.TeapotGeometry(40,15),e=new THREE.MeshPhongMaterial({color:16777215}),r=new THREE.Mesh(o,e);r.name="Teapot",r.position.z-=70,d.add(r);var n=new THREE.TorusGeometry(10,3,15,100),t=new THREE.MeshPhongMaterial({color:16777215}),a=new THREE.Mesh(n,t);a.name="Torus",a.position.z-=-75,d.add(a),x(d)}function W(){R=new THREE.Scene;for(var[o,e]of l.entries()){var r=e.origin,n=e.u,t=e.v,a=new THREE.BoxGeometry(n.length(),t.length(),.01),c=new THREE.MeshPhongMaterial({map:p[o].texture}),i=new THREE.Mesh(a,c);i.name=e.name,e.name=="Left"&&(i.rotation.y=Math.PI/2),e.name=="Right"&&(i.rotation.y=-Math.PI/2),e.name=="Floor"&&(i.rotation.x=Math.PI/2,i.rotation.z=Math.PI);var m=n.clone().multiplyScalar(.5),y=t.clone().multiplyScalar(.5),f=new THREE.Vector3().addVectors(r,m);f.add(y),i.position.set(f.x,f.y,f.z),R.add(i)}x(R)}function _(){p=[];for(var e of l)p.push(new THREE.WebGLRenderTarget(1024,1024))}function Y(){v=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e4),v.position.set(100,100,300),v.lookAt(0,0,0)}function Z(){l=[];var o=new h("Front",new THREE.Vector3(-150,-150,-150),new THREE.Vector3(300,0,0),new THREE.Vector3(0,300,0));l.push(o);var e=new h("Left",new THREE.Vector3(-150,-150,150),new THREE.Vector3(0,0,-300),new THREE.Vector3(0,300,0));l.push(e);var r=new h("Right",new THREE.Vector3(150,-150,-150),new THREE.Vector3(0,0,300),new THREE.Vector3(0,300,0));l.push(r);var n=new h("Floor",new THREE.Vector3(-150,-150,150),new THREE.Vector3(300,0,0),new THREE.Vector3(0,0,-300));l.push(n)}function V(){var o=E.getObjectByName("EyeL");return o.getWorldPosition(new THREE.Vector3)}function L(){var o=E.getObjectByName("EyeR");return o.getWorldPosition(new THREE.Vector3)}function P(o,e){var r=v.clone(),n=new THREE.Matrix4;return n.copy(o).invert(),r.position.set(n.elements[12],n.elements[13],n.elements[14]),r.setRotationFromMatrix(o),r.projectionMatrix=e.clone(),r}var M=function(){var o=s.getContext();requestAnimationFrame(M),s.setClearColor(8421504),s.clear(),H&&s.render(d,v);for(let[c,i]of l.entries()){s.setRenderTarget(p[c]),s.setClearColor(4210752),s.clear(),o.colorMask(1,0,0,0);var r=V(),n=i.viewMatrix(r),t=i.projectionMatrix(r,1,1e4),e=P(n,t);s.render(d,e),o.colorMask(0,1,1,0);var r=L(),n=i.viewMatrix(r),t=i.projectionMatrix(r,1,1e4),a=P(n,t);s.clearDepth(),s.render(d,a),o.colorMask(1,1,1,0)}s.setRenderTarget(null),s.setClearColor(0),s.render(R,v),s.render(E,v)};function q(o){var e=E.getObjectByName("Head"),r=E.getObjectByName("EyeL"),n=E.getObjectByName("EyeR");e.position,r.position.x-=o/2,n.position.x+=o/2}function X(o){var e=E.getObjectByName("Head"),r=E.getObjectByName("EyeL"),n=E.getObjectByName("EyeR");e.position,r.position.x+=o/2,n.position.x-=o/2}window.addEventListener("keydown",function(o){switch(o.code){case"KeyL":var e=V();v.position.set(e.x,e.y,e.z);break;case"KeyR":var e=L();v.position.set(e.x,e.y,e.z);break;case"KeyS":H=!H;break;case"KeyT":var r=l[0].viewMatrix(new THREE.Vector3(50,20,100)),t=l[1].viewMatrix(new THREE.Vector3(50,20,100)),a=l[2].viewMatrix(new THREE.Vector3(50,20,100));console.log("View matrices:"),console.log(r),console.log(t),console.log(a);var n=l[0].projectionMatrix(new THREE.Vector3(0,0,0),1,1e3),t=l[1].viewMatrix(new THREE.Vector3(50,20,100)),a=l[2].viewMatrix(new THREE.Vector3(50,20,100));console.log("Projection matrices:"),console.log(n),console.log(t),console.log(a);break;case"KeyI":q(8);break;case"KeyO":X(8);break}});G();Z();_();W();F(6.8);A();Y();K(v,s);k();M();
