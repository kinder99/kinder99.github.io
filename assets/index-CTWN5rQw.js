import{XRButton as K}from"https://unpkg.com/three@0.181.1/examples/jsm/webxr/XRButton.js";import"https://unpkg.com/three@0.181.1/examples/jsm/webxr/XRControllerModelFactory.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function t(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(o){if(o.ep)return;o.ep=!0;const n=t(o);fetch(o.href,n)}})();class H{constructor(e,t,a,o){this.name=e,this.origin=t,this.u=a,this.v=o}viewMatrix(e){var t=this.u.clone().normalize(),a=this.v.clone().normalize(),o=new THREE.Vector3().crossVectors(t,a),n=new THREE.Vector3().subVectors(e,o),c=new THREE.Vector3(0,1,0),i=new THREE.Matrix4;i=i.lookAt(e,n,c);var w=new THREE.Matrix4().makeTranslation(-e.x,-e.y,-e.z);return i=i.multiplyMatrices(i,w),i}projectionMatrix(e,t,a){var o=this.u.clone().normalize(),n=this.v.clone().normalize(),c=this.origin.clone(),i=this.origin.clone().add(this.u),w=this.origin.clone().add(this.v);c.sub(e),i.sub(e),w.sub(e);var h=this.v.clone().cross(this.u).normalize(),E=c.dot(o),f=i.dot(o),V=c.dot(n),p=w.dot(n),u=c.dot(h),I=E*t/u,F=f*t/u,W=V*t/u,A=p*t/u,G=new THREE.Matrix4().makePerspective(I,F,A,W,t,a);return G}}var s,d,l,v,M,P,y,m,R,g,T=!0,C=!0;const N=new Map;var b;let L,S,x;function _(){x=document.createElement("div"),document.body.appendChild(x),d=new THREE.Scene,d.background=new THREE.Color(16777215),l=new THREE.PerspectiveCamera(70,window.innerWidth/window.innerHeight,.01,20),l.position.set(.2,.2,.6),l.lookAt(0,0,0),d.add(l),s=new THREE.WebGLRenderer({antialias:!0}),s.autoClear=!1,s.setSize(window.innerWidth,window.innerHeight),s.setPixelRatio(window.devicePixelRatio),s.setAnimationLoop(z),s.xr.enabled=!0,x.appendChild(s.domElement),x.appendChild(K.createButton(s));function r(){if(reticle.visible){const e=new THREE.MeshPhongMaterial({color:16777215*Math.random()}),t=new THREE.Mesh(geometry,e);reticle.matrix.decompose(t.position,t.quaternion,t.scale),t.scale.y=Math.random()*2+1,d.add(t)}}L=s.xr.getController(0),L.addEventListener("select",r),d.add(L),S=s.xr.getController(1),S.addEventListener("select",r),d.add(S),$(),Q(),J(),Y(6.8),X(),U(),Z(l,s),q(),z()}function k(){console.log("i am here"),b.scale.x+=event.deltaY/500,b.scale.y+=event.deltaY/500,b.scale.z+=event.deltaY/500}function q(){var r=[];r.push(d.getObjectByName("Teapot")),r.push(d.getObjectByName("Torus")),r.push(m.getObjectByName("Head")),g=new THREE.DragControls(r,l,s.domElement),g.addEventListener("hoveron",function(e){R.enabled=!1}),g.addEventListener("hoveroff",function(e){R.enabled=!0}),g.addEventListener("dragstart",function(e){e.object.material.emissive.set(11184810),b=e.object,window.addEventListener("wheel",k,!1)}),g.addEventListener("dragend",function(e){e.object.material.emissive.set(0),window.removeEventListener("wheel",k,!1)})}function Y(e){var e=6.8;y=new THREE.Vector3(50,20,50);var t=new THREE.Vector3(-e/2,10,-6),a=new THREE.Vector3(+e/2,10,-6);m=new THREE.Scene;var n=new THREE.SphereGeometry(10,32,22),c=new THREE.MeshPhongMaterial({color:11184810}),o=new THREE.Mesh(n,c);o.name="Head",o.position.set(y.x,y.y,y.z),m.add(o);var n=new THREE.SphereGeometry(3,32,22),c=new THREE.MeshPhongMaterial({color:16711680}),i=new THREE.Mesh(n,c);i.name="EyeL",i.position.set(t.x,t.y,t.z),o.add(i);var n=new THREE.SphereGeometry(3,32,22),c=new THREE.MeshPhongMaterial({color:255}),i=new THREE.Mesh(n,c);i.name="EyeR",i.position.set(a.x,a.y,a.z),o.add(i),B(m)}function Z(r,e){R=new THREE.OrbitControls(r,e.domElement),R.minDistance=120,R.maxDistance=5e4}function B(r){var e=new THREE.AmbientLight(8947848,.4);r.add(e);var t=new THREE.PointLight(16777215,.8);t.position.z+=200,r.add(t)}function X(){d=new THREE.Scene;var r=new THREE.TeapotGeometry(40,15),e=new THREE.MeshPhongMaterial({color:16777215}),t=new THREE.Mesh(r,e);t.name="Teapot",t.position.z-=70,d.add(t);var a=new THREE.TorusGeometry(10,3,15,100),o=new THREE.MeshPhongMaterial({color:16777215}),n=new THREE.Mesh(a,o);n.name="Torus",n.position.z-=-75,d.add(n),B(d)}function J(){M=new THREE.Scene;for(var[r,e]of v.entries()){var t=e.origin,a=e.u,o=e.v,n=new THREE.BoxGeometry(a.length(),o.length(),.01),c=new THREE.MeshPhongMaterial({map:P[r].texture}),i=new THREE.Mesh(n,c);i.name=e.name,e.name=="Left"&&(i.rotation.y=Math.PI/2),e.name=="Right"&&(i.rotation.y=-Math.PI/2),e.name=="Floor"&&(i.rotation.x=Math.PI/2,i.rotation.z=Math.PI);var w=a.clone().multiplyScalar(.5),h=o.clone().multiplyScalar(.5),E=new THREE.Vector3().addVectors(t,w);E.add(h),i.position.set(E.x,E.y,E.z),M.add(i)}B(M)}function Q(){P=[];for(var e of v)P.push(new THREE.WebGLRenderTarget(1024,1024))}function U(){l=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e4),l.position.set(100,100,300),l.lookAt(0,0,0)}function $(){v=[];var r=new H("Front",new THREE.Vector3(-150,-150,-150),new THREE.Vector3(300,0,0),new THREE.Vector3(0,300,0));v.push(r);var e=new H("Left",new THREE.Vector3(-150,-150,150),new THREE.Vector3(0,0,-300),new THREE.Vector3(0,300,0));v.push(e);var t=new H("Right",new THREE.Vector3(150,-150,-150),new THREE.Vector3(0,0,300),new THREE.Vector3(0,300,0));v.push(t);var a=new H("Floor",new THREE.Vector3(-150,-150,150),new THREE.Vector3(300,0,0),new THREE.Vector3(0,0,-300));v.push(a)}function j(){var r=m.getObjectByName("EyeL");return r.getWorldPosition(new THREE.Vector3)}function O(){var r=m.getObjectByName("EyeR");return r.getWorldPosition(new THREE.Vector3)}function D(r,e){var t=l.clone(),a=new THREE.Matrix4;return a.copy(r).invert(),t.position.set(a.elements[12],a.elements[13],a.elements[14]),t.setRotationFromMatrix(r),t.projectionMatrix=e.clone(),t}function ee(r,e){if(e.handedness=="right")switch(r){case 4:C=!C;break;case 5:T=!T;break}}function z(){const r=s.xr.isPresenting,e=r?s.xr.getCamera(l):l;var t;r&&C?e.cameras&&e.cameras.length>=2?(t=new THREE.Vector3().setFromMatrixPosition(e.cameras[0].matrixWorld),new THREE.Vector3().setFromMatrixPosition(e.cameras[1].matrixWorld)):(t=new THREE.Vector3().setFromMatrixPosition(e.matrixWorld),t.clone()):(t=j(),O());var a=s.getContext();requestAnimationFrame(z),s.setClearColor(8421504),s.clear(),T&&s.render(d,l);for(let[E,f]of v.entries()){s.setRenderTarget(P[E]),s.setClearColor(4210752),s.clear(),a.colorMask(1,0,0,0);var n=j(),c=f.viewMatrix(n),i=f.projectionMatrix(n,1,1e4),o=D(c,i);s.render(d,o),a.colorMask(0,1,1,0);var n=O(),c=f.viewMatrix(n),i=f.projectionMatrix(n,1,1e4),w=D(c,i);s.clearDepth(),s.render(d,w),a.colorMask(1,1,1,0)}s.setRenderTarget(null),s.setClearColor(0),s.render(M,l),s.render(m,l);const h=s.xr.getSession();if(h){for(const E of h.inputSources)if(E&&E.gamepad){const f=E.gamepad;let V=N.get(E)||f.buttons.map(()=>({pressed:!1}));f.buttons.forEach((p,u)=>{p.pressed&&!V[u].pressed&&ee(u,E)}),N.set(E,f.buttons.map(p=>({pressed:p.pressed})))}}}function te(r){var e=m.getObjectByName("Head"),t=m.getObjectByName("EyeL"),a=m.getObjectByName("EyeR");e.position,t.position.x-=r/2,a.position.x+=r/2}function re(r){var e=m.getObjectByName("Head"),t=m.getObjectByName("EyeL"),a=m.getObjectByName("EyeR");e.position,t.position.x+=r/2,a.position.x-=r/2}window.addEventListener("keydown",function(r){switch(r.code){case"KeyL":var e=j();l.position.set(e.x,e.y,e.z);break;case"KeyR":var e=O();l.position.set(e.x,e.y,e.z);break;case"KeyS":T=!T;break;case"KeyT":var t=v[0].viewMatrix(new THREE.Vector3(50,20,100)),o=v[1].viewMatrix(new THREE.Vector3(50,20,100)),n=v[2].viewMatrix(new THREE.Vector3(50,20,100));console.log("View matrices:"),console.log(t),console.log(o),console.log(n);var a=v[0].projectionMatrix(new THREE.Vector3(0,0,0),1,1e3),o=v[1].viewMatrix(new THREE.Vector3(50,20,100)),n=v[2].viewMatrix(new THREE.Vector3(50,20,100));console.log("Projection matrices:"),console.log(a),console.log(o),console.log(n);break;case"KeyI":te(8);break;case"KeyO":re(8);break}});_();
