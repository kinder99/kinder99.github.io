import"https://unpkg.com/three@0.181.1/examples/jsm/webxr/XRButton.js";import"https://unpkg.com/three@0.181.1/examples/jsm/webxr/XRControllerModelFactory.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function r(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(t){if(t.ep)return;t.ep=!0;const o=r(t);fetch(t.href,o)}})();class R{constructor(e,r,n,t){this.name=e,this.origin=r,this.u=n,this.v=t}viewMatrix(e){var r=this.u.clone().normalize(),n=this.v.clone().normalize(),t=new THREE.Vector3().crossVectors(r,n),o=new THREE.Vector3().subVectors(e,t),c=new THREE.Vector3(0,1,0),i=new THREE.Matrix4;i=i.lookAt(e,o,c);var f=new THREE.Matrix4().makeTranslation(-e.x,-e.y,-e.z);return i=i.multiplyMatrices(i,f),i}projectionMatrix(e,r,n){var t=this.u.clone().normalize(),o=this.v.clone().normalize(),c=this.origin.clone(),i=this.origin.clone().add(this.u),f=this.origin.clone().add(this.v);c.sub(e),i.sub(e),f.sub(e);var w=this.v.clone().cross(this.u).normalize(),m=c.dot(t),j=i.dot(t),O=c.dot(o),C=f.dot(o),g=c.dot(w),z=m*r/g,D=j*r/g,N=O*r/g,B=C*r/g,I=new THREE.Matrix4().makePerspective(z,D,B,N,r,n);return I}}var s,d,E,l,p,H,T,v,h,u,x=!0,y;function L(){console.log("i am here"),y.scale.x+=event.deltaY/500,y.scale.y+=event.deltaY/500,y.scale.z+=event.deltaY/500}function F(){var a=[];a.push(d.getObjectByName("Teapot")),a.push(d.getObjectByName("Torus")),a.push(v.getObjectByName("Head")),u=new THREE.DragControls(a,E,s.domElement),u.addEventListener("hoveron",function(e){h.enabled=!1}),u.addEventListener("hoveroff",function(e){h.enabled=!0}),u.addEventListener("dragstart",function(e){e.object.material.emissive.set(11184810),y=e.object,window.addEventListener("wheel",L,!1)}),u.addEventListener("dragend",function(e){e.object.material.emissive.set(0),window.removeEventListener("wheel",L,!1)})}function k(e){var e=6.8;T=new THREE.Vector3(50,20,50);var r=new THREE.Vector3(-e/2,10,-6),n=new THREE.Vector3(+e/2,10,-6);v=new THREE.Scene;var o=new THREE.SphereGeometry(10,32,22),c=new THREE.MeshPhongMaterial({color:11184810}),t=new THREE.Mesh(o,c);t.name="Head",t.position.set(T.x,T.y,T.z),v.add(t);var o=new THREE.SphereGeometry(3,32,22),c=new THREE.MeshPhongMaterial({color:16711680}),i=new THREE.Mesh(o,c);i.name="EyeL",i.position.set(r.x,r.y,r.z),t.add(i);var o=new THREE.SphereGeometry(3,32,22),c=new THREE.MeshPhongMaterial({color:255}),i=new THREE.Mesh(o,c);i.name="EyeR",i.position.set(n.x,n.y,n.z),t.add(i),b(v)}function W(){s=new THREE.WebGLRenderer({preserveDrawingBuffer:!0}),s.autoClear=!1,s.setSize(window.innerWidth,window.innerHeight),s.setPixelRatio(window.devicePixelRatio),s.setAnimationLoop(V),document.body.appendChild(s.domElement)}function G(a,e){h=new THREE.OrbitControls(a,e.domElement),h.minDistance=120,h.maxDistance=5e4}function b(a){var e=new THREE.AmbientLight(8947848,.4);a.add(e);var r=new THREE.PointLight(16777215,.8);r.position.z+=200,a.add(r)}function A(){d=new THREE.Scene;var a=new THREE.TeapotGeometry(40,15),e=new THREE.MeshPhongMaterial({color:16777215}),r=new THREE.Mesh(a,e);r.name="Teapot",r.position.z-=70,d.add(r);var n=new THREE.TorusGeometry(10,3,15,100),t=new THREE.MeshPhongMaterial({color:16777215}),o=new THREE.Mesh(n,t);o.name="Torus",o.position.z-=-75,d.add(o),b(d)}function K(){p=new THREE.Scene;for(var[a,e]of l.entries()){var r=e.origin,n=e.u,t=e.v,o=new THREE.BoxGeometry(n.length(),t.length(),.01),c=new THREE.MeshPhongMaterial({map:H[a].texture}),i=new THREE.Mesh(o,c);i.name=e.name,e.name=="Left"&&(i.rotation.y=Math.PI/2),e.name=="Right"&&(i.rotation.y=-Math.PI/2),e.name=="Floor"&&(i.rotation.x=Math.PI/2,i.rotation.z=Math.PI);var f=n.clone().multiplyScalar(.5),w=t.clone().multiplyScalar(.5),m=new THREE.Vector3().addVectors(r,f);m.add(w),i.position.set(m.x,m.y,m.z),p.add(i)}b(p)}function _(){H=[];for(var e of l)H.push(new THREE.WebGLRenderTarget(1024,1024))}function Y(){E=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e4),E.position.set(100,100,300),E.lookAt(0,0,0)}function Z(){l=[];var a=new R("Front",new THREE.Vector3(-150,-150,-150),new THREE.Vector3(300,0,0),new THREE.Vector3(0,300,0));l.push(a);var e=new R("Left",new THREE.Vector3(-150,-150,150),new THREE.Vector3(0,0,-300),new THREE.Vector3(0,300,0));l.push(e);var r=new R("Right",new THREE.Vector3(150,-150,-150),new THREE.Vector3(0,0,300),new THREE.Vector3(0,300,0));l.push(r);var n=new R("Floor",new THREE.Vector3(-150,-150,150),new THREE.Vector3(300,0,0),new THREE.Vector3(0,0,-300));l.push(n)}function M(){var a=v.getObjectByName("EyeL");return a.getWorldPosition(new THREE.Vector3)}function P(){var a=v.getObjectByName("EyeR");return a.getWorldPosition(new THREE.Vector3)}function S(a,e){var r=E.clone(),n=new THREE.Matrix4;return n.copy(a).invert(),r.position.set(n.elements[12],n.elements[13],n.elements[14]),r.setRotationFromMatrix(a),r.projectionMatrix=e.clone(),r}function V(){const a=s.xr.isPresenting,e=a?s.xr.getCamera(E):E;var r;a&&useVReyes?e.cameras&&e.cameras.length>=2?(r=new THREE.Vector3().setFromMatrixPosition(e.cameras[0].matrixWorld),new THREE.Vector3().setFromMatrixPosition(e.cameras[1].matrixWorld)):(r=new THREE.Vector3().setFromMatrixPosition(e.matrixWorld),r.clone()):(r=M(),P());var n=s.getContext();requestAnimationFrame(V),s.setClearColor(8421504),s.clear(),x&&s.render(d,E);for(let[w,m]of l.entries()){s.setRenderTarget(H[w]),s.setClearColor(4210752),s.clear(),n.colorMask(1,0,0,0);var o=M(),c=m.viewMatrix(o),i=m.projectionMatrix(o,1,1e4),t=S(c,i);s.render(d,t),n.colorMask(0,1,1,0);var o=P(),c=m.viewMatrix(o),i=m.projectionMatrix(o,1,1e4),f=S(c,i);s.clearDepth(),s.render(d,f),n.colorMask(1,1,1,0)}s.setRenderTarget(null),s.setClearColor(0),s.render(p,E),s.render(v,E)}function q(a){var e=v.getObjectByName("Head"),r=v.getObjectByName("EyeL"),n=v.getObjectByName("EyeR");e.position,r.position.x-=a/2,n.position.x+=a/2}function J(a){var e=v.getObjectByName("Head"),r=v.getObjectByName("EyeL"),n=v.getObjectByName("EyeR");e.position,r.position.x+=a/2,n.position.x-=a/2}window.addEventListener("keydown",function(a){switch(a.code){case"KeyL":var e=M();E.position.set(e.x,e.y,e.z);break;case"KeyR":var e=P();E.position.set(e.x,e.y,e.z);break;case"KeyS":x=!x;break;case"KeyT":var r=l[0].viewMatrix(new THREE.Vector3(50,20,100)),t=l[1].viewMatrix(new THREE.Vector3(50,20,100)),o=l[2].viewMatrix(new THREE.Vector3(50,20,100));console.log("View matrices:"),console.log(r),console.log(t),console.log(o);var n=l[0].projectionMatrix(new THREE.Vector3(0,0,0),1,1e3),t=l[1].viewMatrix(new THREE.Vector3(50,20,100)),o=l[2].viewMatrix(new THREE.Vector3(50,20,100));console.log("Projection matrices:"),console.log(n),console.log(t),console.log(o);break;case"KeyI":q(8);break;case"KeyO":J(8);break}});W();Z();_();K();k(6.8);A();Y();G(E,s);F();V();
