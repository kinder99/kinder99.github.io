import{XRButton as G}from"https://unpkg.com/three@0.181.1/examples/jsm/webxr/XRButton.js";import"https://unpkg.com/three@0.181.1/examples/jsm/webxr/XRControllerModelFactory.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function t(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(o){if(o.ep)return;o.ep=!0;const n=t(o);fetch(o.href,n)}})();class R{constructor(e,t,a,o){this.name=e,this.origin=t,this.u=a,this.v=o}viewMatrix(e){var t=this.u.clone().normalize(),a=this.v.clone().normalize(),o=new THREE.Vector3().crossVectors(t,a),n=new THREE.Vector3().subVectors(e,o),c=new THREE.Vector3(0,1,0),i=new THREE.Matrix4;i=i.lookAt(e,n,c);var f=new THREE.Matrix4().makeTranslation(-e.x,-e.y,-e.z);return i=i.multiplyMatrices(i,f),i}projectionMatrix(e,t,a){var o=this.u.clone().normalize(),n=this.v.clone().normalize(),c=this.origin.clone(),i=this.origin.clone().add(this.u),f=this.origin.clone().add(this.v);c.sub(e),i.sub(e),f.sub(e);var w=this.v.clone().cross(this.u).normalize(),m=c.dot(o),z=i.dot(o),B=c.dot(n),N=f.dot(n),g=c.dot(w),D=m*t/g,I=z*t/g,F=B*t/g,k=N*t/g,W=new THREE.Matrix4().makePerspective(D,I,k,F,t,a);return W}}var s,E,d,l,H,x,T,v,u,h,P=!0,y;let M,b,p;function A(){p=document.createElement("div"),document.body.appendChild(p),E=new THREE.Scene,E.background=new THREE.Color(16777215),d=new THREE.PerspectiveCamera(70,window.innerWidth/window.innerHeight,.01,20),s=new THREE.WebGLRenderer({antialias:!0}),s.autoClear=!1,s.setSize(window.innerWidth,window.innerHeight),s.setPixelRatio(window.devicePixelRatio),s.setAnimationLoop(S),s.xr.enabled=!0,p.appendChild(s.domElement),p.appendChild(G.createButton(s));function r(){if(reticle.visible){const e=new THREE.MeshPhongMaterial({color:16777215*Math.random()}),t=new THREE.Mesh(geometry,e);reticle.matrix.decompose(t.position,t.quaternion,t.scale),t.scale.y=Math.random()*2+1,E.add(t)}}M=s.xr.getController(0),M.addEventListener("select",r),E.add(M),b=s.xr.getController(1),b.addEventListener("select",r),E.add(b),Q(),X(),Z(),_(6.8),Y(),J(),q(d,s),K(),S()}function j(){console.log("i am here"),y.scale.x+=event.deltaY/500,y.scale.y+=event.deltaY/500,y.scale.z+=event.deltaY/500}function K(){var r=[];r.push(E.getObjectByName("Teapot")),r.push(E.getObjectByName("Torus")),r.push(v.getObjectByName("Head")),h=new THREE.DragControls(r,d,s.domElement),h.addEventListener("hoveron",function(e){u.enabled=!1}),h.addEventListener("hoveroff",function(e){u.enabled=!0}),h.addEventListener("dragstart",function(e){e.object.material.emissive.set(11184810),y=e.object,window.addEventListener("wheel",j,!1)}),h.addEventListener("dragend",function(e){e.object.material.emissive.set(0),window.removeEventListener("wheel",j,!1)})}function _(e){var e=6.8;T=new THREE.Vector3(50,20,50);var t=new THREE.Vector3(-e/2,10,-6),a=new THREE.Vector3(+e/2,10,-6);v=new THREE.Scene;var n=new THREE.SphereGeometry(10,32,22),c=new THREE.MeshPhongMaterial({color:11184810}),o=new THREE.Mesh(n,c);o.name="Head",o.position.set(T.x,T.y,T.z),v.add(o);var n=new THREE.SphereGeometry(3,32,22),c=new THREE.MeshPhongMaterial({color:16711680}),i=new THREE.Mesh(n,c);i.name="EyeL",i.position.set(t.x,t.y,t.z),o.add(i);var n=new THREE.SphereGeometry(3,32,22),c=new THREE.MeshPhongMaterial({color:255}),i=new THREE.Mesh(n,c);i.name="EyeR",i.position.set(a.x,a.y,a.z),o.add(i),C(v)}function q(r,e){u=new THREE.OrbitControls(r,e.domElement),u.minDistance=120,u.maxDistance=5e4}function C(r){var e=new THREE.AmbientLight(8947848,.4);r.add(e);var t=new THREE.PointLight(16777215,.8);t.position.z+=200,r.add(t)}function Y(){E=new THREE.Scene;var r=new THREE.TeapotGeometry(40,15),e=new THREE.MeshPhongMaterial({color:16777215}),t=new THREE.Mesh(r,e);t.name="Teapot",t.position.z-=70,E.add(t);var a=new THREE.TorusGeometry(10,3,15,100),o=new THREE.MeshPhongMaterial({color:16777215}),n=new THREE.Mesh(a,o);n.name="Torus",n.position.z-=-75,E.add(n),C(E)}function Z(){H=new THREE.Scene;for(var[r,e]of l.entries()){var t=e.origin,a=e.u,o=e.v,n=new THREE.BoxGeometry(a.length(),o.length(),.01),c=new THREE.MeshPhongMaterial({map:x[r].texture}),i=new THREE.Mesh(n,c);i.name=e.name,e.name=="Left"&&(i.rotation.y=Math.PI/2),e.name=="Right"&&(i.rotation.y=-Math.PI/2),e.name=="Floor"&&(i.rotation.x=Math.PI/2,i.rotation.z=Math.PI);var f=a.clone().multiplyScalar(.5),w=o.clone().multiplyScalar(.5),m=new THREE.Vector3().addVectors(t,f);m.add(w),i.position.set(m.x,m.y,m.z),H.add(i)}C(H)}function X(){x=[];for(var e of l)x.push(new THREE.WebGLRenderTarget(1024,1024))}function J(){d=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e4),d.position.set(100,100,300),d.lookAt(0,0,0)}function Q(){l=[];var r=new R("Front",new THREE.Vector3(-150,-150,-150),new THREE.Vector3(300,0,0),new THREE.Vector3(0,300,0));l.push(r);var e=new R("Left",new THREE.Vector3(-150,-150,150),new THREE.Vector3(0,0,-300),new THREE.Vector3(0,300,0));l.push(e);var t=new R("Right",new THREE.Vector3(150,-150,-150),new THREE.Vector3(0,0,300),new THREE.Vector3(0,300,0));l.push(t);var a=new R("Floor",new THREE.Vector3(-150,-150,150),new THREE.Vector3(300,0,0),new THREE.Vector3(0,0,-300));l.push(a)}function V(){var r=v.getObjectByName("EyeL");return r.getWorldPosition(new THREE.Vector3)}function L(){var r=v.getObjectByName("EyeR");return r.getWorldPosition(new THREE.Vector3)}function O(r,e){var t=d.clone(),a=new THREE.Matrix4;return a.copy(r).invert(),t.position.set(a.elements[12],a.elements[13],a.elements[14]),t.setRotationFromMatrix(r),t.projectionMatrix=e.clone(),t}function S(){const r=s.xr.isPresenting,e=r?s.xr.getCamera(d):d;var t;r&&useVReyes?e.cameras&&e.cameras.length>=2?(t=new THREE.Vector3().setFromMatrixPosition(e.cameras[0].matrixWorld),new THREE.Vector3().setFromMatrixPosition(e.cameras[1].matrixWorld)):(t=new THREE.Vector3().setFromMatrixPosition(e.matrixWorld),t.clone()):(t=V(),L());var a=s.getContext();requestAnimationFrame(S),s.setClearColor(8421504),s.clear(),P&&s.render(E,d);for(let[w,m]of l.entries()){s.setRenderTarget(x[w]),s.setClearColor(4210752),s.clear(),a.colorMask(1,0,0,0);var n=V(),c=m.viewMatrix(n),i=m.projectionMatrix(n,1,1e4),o=O(c,i);s.render(E,o),a.colorMask(0,1,1,0);var n=L(),c=m.viewMatrix(n),i=m.projectionMatrix(n,1,1e4),f=O(c,i);s.clearDepth(),s.render(E,f),a.colorMask(1,1,1,0)}s.setRenderTarget(null),s.setClearColor(0),s.render(H,d),s.render(v,d)}function U(r){var e=v.getObjectByName("Head"),t=v.getObjectByName("EyeL"),a=v.getObjectByName("EyeR");e.position,t.position.x-=r/2,a.position.x+=r/2}function $(r){var e=v.getObjectByName("Head"),t=v.getObjectByName("EyeL"),a=v.getObjectByName("EyeR");e.position,t.position.x+=r/2,a.position.x-=r/2}window.addEventListener("keydown",function(r){switch(r.code){case"KeyL":var e=V();d.position.set(e.x,e.y,e.z);break;case"KeyR":var e=L();d.position.set(e.x,e.y,e.z);break;case"KeyS":P=!P;break;case"KeyT":var t=l[0].viewMatrix(new THREE.Vector3(50,20,100)),o=l[1].viewMatrix(new THREE.Vector3(50,20,100)),n=l[2].viewMatrix(new THREE.Vector3(50,20,100));console.log("View matrices:"),console.log(t),console.log(o),console.log(n);var a=l[0].projectionMatrix(new THREE.Vector3(0,0,0),1,1e3),o=l[1].viewMatrix(new THREE.Vector3(50,20,100)),n=l[2].viewMatrix(new THREE.Vector3(50,20,100));console.log("Projection matrices:"),console.log(a),console.log(o),console.log(n);break;case"KeyI":U(8);break;case"KeyO":$(8);break}});A();
