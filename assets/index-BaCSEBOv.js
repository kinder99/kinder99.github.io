import{XRButton as K}from"https://unpkg.com/three@0.181.1/examples/jsm/webxr/XRButton.js";import"https://unpkg.com/three@0.181.1/examples/jsm/webxr/XRControllerModelFactory.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function t(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=t(o);fetch(o.href,a)}})();class y{constructor(e,t,n,o){this.name=e,this.origin=t,this.u=n,this.v=o}viewMatrix(e){var t=this.u.clone().normalize(),n=this.v.clone().normalize(),o=new THREE.Vector3().crossVectors(t,n),a=new THREE.Vector3().subVectors(e,o),c=new THREE.Vector3(0,1,0),s=new THREE.Matrix4;s=s.lookAt(e,a,c);var m=new THREE.Matrix4().makeTranslation(-e.x,-e.y,-e.z);return s=s.multiplyMatrices(s,m),s}projectionMatrix(e,t,n){var o=this.u.clone().normalize(),a=this.v.clone().normalize(),c=this.origin.clone(),s=this.origin.clone().add(this.u),m=this.origin.clone().add(this.v);c.sub(e),s.sub(e),m.sub(e);var p=this.v.clone().cross(this.u).normalize(),u=c.dot(o),f=s.dot(o),w=c.dot(a),L=m.dot(a),h=c.dot(p),H=u*t/h,F=f*t/h,W=w*t/h,A=L*t/h,G=new THREE.Matrix4().makePerspective(H,F,A,W,t,n);return G}}var i,E,l,d,b,V,x,v,R,g,T=!0,j=!0;const k=new Map;var P;let S,C,M;function _(){M=document.createElement("div"),document.body.appendChild(M),E=new THREE.Scene,E.background=new THREE.Color(16777215),l=new THREE.PerspectiveCamera(70,window.innerWidth/window.innerHeight,.01,20),l.position.set(.2,.2,.6),l.lookAt(0,0,0),E.add(l),i=new THREE.WebGLRenderer({antialias:!0}),i.autoClear=!1,i.setSize(window.innerWidth,window.innerHeight),i.setPixelRatio(window.devicePixelRatio),i.setAnimationLoop(B),i.xr.enabled=!0,M.appendChild(i.domElement),M.appendChild(K.createButton(i));function r(){if(reticle.visible){const e=new THREE.MeshPhongMaterial({color:16777215*Math.random()}),t=new THREE.Mesh(geometry,e);reticle.matrix.decompose(t.position,t.quaternion,t.scale),t.scale.y=Math.random()*2+1,E.add(t)}}S=i.xr.getController(0),S.addEventListener("select",r),E.add(S),C=i.xr.getController(1),C.addEventListener("select",r),E.add(C),$(),Q(),J(),Y(6.8),X(),U(),Z(l,i),q(),B()}function D(){console.log("i am here"),P.scale.x+=event.deltaY/500,P.scale.y+=event.deltaY/500,P.scale.z+=event.deltaY/500}function q(){var r=[];r.push(E.getObjectByName("Teapot")),r.push(E.getObjectByName("Torus")),r.push(v.getObjectByName("Head")),g=new THREE.DragControls(r,l,i.domElement),g.addEventListener("hoveron",function(e){R.enabled=!1}),g.addEventListener("hoveroff",function(e){R.enabled=!0}),g.addEventListener("dragstart",function(e){e.object.material.emissive.set(11184810),P=e.object,window.addEventListener("wheel",D,!1)}),g.addEventListener("dragend",function(e){e.object.material.emissive.set(0),window.removeEventListener("wheel",D,!1)})}function Y(e){var e=6.8;x=new THREE.Vector3(50,20,50);var t=new THREE.Vector3(-e/2,10,-6),n=new THREE.Vector3(+e/2,10,-6);v=new THREE.Scene;var a=new THREE.SphereGeometry(10,32,22),c=new THREE.MeshPhongMaterial({color:11184810}),o=new THREE.Mesh(a,c);o.name="Head",o.position.set(x.x,x.y,x.z),v.add(o);var a=new THREE.SphereGeometry(3,32,22),c=new THREE.MeshPhongMaterial({color:16711680}),s=new THREE.Mesh(a,c);s.name="EyeL",s.position.set(t.x,t.y,t.z),o.add(s);var a=new THREE.SphereGeometry(3,32,22),c=new THREE.MeshPhongMaterial({color:255}),s=new THREE.Mesh(a,c);s.name="EyeR",s.position.set(n.x,n.y,n.z),o.add(s),N(v)}function Z(r,e){R=new THREE.OrbitControls(r,e.domElement),R.minDistance=120,R.maxDistance=5e4}function N(r){var e=new THREE.AmbientLight(8947848,.4);r.add(e);var t=new THREE.PointLight(16777215,.8);t.position.z+=200,r.add(t)}function X(){E=new THREE.Scene;var r=new THREE.TeapotGeometry(40,15),e=new THREE.MeshPhongMaterial({color:16777215}),t=new THREE.Mesh(r,e);t.name="Teapot",t.position.z-=70,E.add(t);var n=new THREE.TorusGeometry(10,3,15,100),o=new THREE.MeshPhongMaterial({color:16777215}),a=new THREE.Mesh(n,o);a.name="Torus",a.position.z-=-75,E.add(a),N(E)}function J(){b=new THREE.Scene;for(var[r,e]of d.entries()){var t=e.origin,n=e.u,o=e.v,a=new THREE.BoxGeometry(n.length(),o.length(),.01),c=new THREE.MeshPhongMaterial({map:V[r].texture}),s=new THREE.Mesh(a,c);s.name=e.name,e.name=="Left"&&(s.rotation.y=Math.PI/2),e.name=="Right"&&(s.rotation.y=-Math.PI/2),e.name=="Floor"&&(s.rotation.x=Math.PI/2,s.rotation.z=Math.PI);var m=n.clone().multiplyScalar(.5),p=o.clone().multiplyScalar(.5),u=new THREE.Vector3().addVectors(t,m);u.add(p),s.position.set(u.x,u.y,u.z),b.add(s)}N(b)}function Q(){V=[];for(var e of d)V.push(new THREE.WebGLRenderTarget(1024,1024))}function U(){l=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e4),l.position.set(100,100,300),l.lookAt(0,0,0)}function $(){d=[];var r=new y("Front",new THREE.Vector3(-150,-150,-150),new THREE.Vector3(300,0,0),new THREE.Vector3(0,300,0));d.push(r);var e=new y("Left",new THREE.Vector3(-150,-150,150),new THREE.Vector3(0,0,-300),new THREE.Vector3(0,300,0));d.push(e);var t=new y("Right",new THREE.Vector3(150,-150,-150),new THREE.Vector3(0,0,300),new THREE.Vector3(0,300,0));d.push(t);var n=new y("Floor",new THREE.Vector3(-150,-150,150),new THREE.Vector3(300,0,0),new THREE.Vector3(0,0,-300));d.push(n)}function O(){var r=v.getObjectByName("EyeL");return r.getWorldPosition(new THREE.Vector3)}function z(){var r=v.getObjectByName("EyeR");return r.getWorldPosition(new THREE.Vector3)}function I(r,e){var t=l.clone(),n=new THREE.Matrix4;return n.copy(r).invert(),t.position.set(n.elements[12],n.elements[13],n.elements[14]),t.setRotationFromMatrix(r),t.projectionMatrix=e.clone(),t}function ee(r,e){if(e.handedness=="right")switch(r){case 4:j=!j;break;case 5:T=!T;break}}function B(){const r=i.xr.isPresenting,e=r?i.xr.getCamera(l):l;var t;r&&j?e.cameras&&e.cameras.length>=2?(t=new THREE.Vector3().setFromMatrixPosition(e.cameras[0].matrixWorld),new THREE.Vector3().setFromMatrixPosition(e.cameras[1].matrixWorld)):(t=new THREE.Vector3().setFromMatrixPosition(e.matrixWorld),t.clone()):(t=O(),z());var n=i.getContext();requestAnimationFrame(B);var o=i.xr.enabled;i.xr.enabled=!1,i.setClearColor(8421504),i.clear(),T&&i.render(E,l);for(let[f,w]of d.entries()){i.setRenderTarget(V[f]),i.setClearColor(4210752),i.clear(),n.colorMask(1,0,0,0);var c=O(),s=w.viewMatrix(c),m=w.projectionMatrix(c,1,1e4),a=I(s,m);i.render(E,a),n.colorMask(0,1,1,0);var c=z(),s=w.viewMatrix(c),m=w.projectionMatrix(c,1,1e4),p=I(s,m);i.clearDepth(),i.render(E,p),n.colorMask(1,1,1,0)}i.xr.enabled=o,i.setRenderTarget(null),i.setClearColor(0),i.render(b,l),i.render(v,l);const u=i.xr.getSession();if(u){for(const f of u.inputSources)if(f&&f.gamepad){const w=f.gamepad;let L=k.get(f)||w.buttons.map(()=>({pressed:!1}));w.buttons.forEach((h,H)=>{h.pressed&&!L[H].pressed&&ee(H,f)}),k.set(f,w.buttons.map(h=>({pressed:h.pressed})))}}}function te(r){var e=v.getObjectByName("Head"),t=v.getObjectByName("EyeL"),n=v.getObjectByName("EyeR");e.position,t.position.x-=r/2,n.position.x+=r/2}function re(r){var e=v.getObjectByName("Head"),t=v.getObjectByName("EyeL"),n=v.getObjectByName("EyeR");e.position,t.position.x+=r/2,n.position.x-=r/2}window.addEventListener("keydown",function(r){switch(r.code){case"KeyL":var e=O();l.position.set(e.x,e.y,e.z);break;case"KeyR":var e=z();l.position.set(e.x,e.y,e.z);break;case"KeyS":T=!T;break;case"KeyT":var t=d[0].viewMatrix(new THREE.Vector3(50,20,100)),o=d[1].viewMatrix(new THREE.Vector3(50,20,100)),a=d[2].viewMatrix(new THREE.Vector3(50,20,100));console.log("View matrices:"),console.log(t),console.log(o),console.log(a);var n=d[0].projectionMatrix(new THREE.Vector3(0,0,0),1,1e3),o=d[1].viewMatrix(new THREE.Vector3(50,20,100)),a=d[2].viewMatrix(new THREE.Vector3(50,20,100));console.log("Projection matrices:"),console.log(n),console.log(o),console.log(a);break;case"KeyI":te(8);break;case"KeyO":re(8);break}});_();
