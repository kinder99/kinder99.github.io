import"https://unpkg.com/three@0.181.1/examples/jsm/webxr/XRButton.js";import"https://unpkg.com/three@0.181.1/examples/jsm/webxr/XRControllerModelFactory.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function t(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(r){if(r.ep)return;r.ep=!0;const n=t(r);fetch(r.href,n)}})();class g{constructor(e,t,a,r){this.name=e,this.origin=t,this.u=a,this.v=r}viewMatrix(e){var t=this.u.clone().normalize(),a=this.v.clone().normalize(),r=new THREE.Vector3().crossVectors(t,a),n=new THREE.Vector3().subVectors(e,r),c=new THREE.Vector3(0,1,0),i=new THREE.Matrix4;i=i.lookAt(e,n,c);var v=new THREE.Matrix4().makeTranslation(-e.x,-e.y,-e.z);return i=i.multiplyMatrices(i,v),i}projectionMatrix(e,t,a){var r=this.u.clone().normalize(),n=this.v.clone().normalize(),c=this.origin.clone(),i=this.origin.clone().add(this.u),v=this.origin.clone().add(this.v);c.sub(e),i.sub(e),v.sub(e);var H=this.v.clone().cross(this.u).normalize(),f=c.dot(r),O=i.dot(r),C=c.dot(n),z=v.dot(n),h=c.dot(H),N=f*t/h,D=O*t/h,I=C*t/h,B=z*t/h,k=new THREE.Matrix4().makePerspective(N,D,B,I,t,a);return k}}var s,m,d,l,p,y,T,E,u,w,M=!0,R;let x;function G(){x=document.createElement("div"),document.body.appendChild(x),s=new THREE.WebGLRenderer({antialias:!0}),s.autoClear=!1,s.setSize(window.innerWidth,window.innerHeight),s.setPixelRatio(window.devicePixelRatio),s.setAnimationLoop(L),s.xr.enabled=!0,x.appendChild(s.domElement),q(),Y(),_(),K(6.8),A(),Z(),W(d,s),F(),L()}function P(){console.log("i am here"),R.scale.x+=event.deltaY/500,R.scale.y+=event.deltaY/500,R.scale.z+=event.deltaY/500}function F(){var o=[];o.push(m.getObjectByName("Teapot")),o.push(m.getObjectByName("Torus")),o.push(E.getObjectByName("Head")),w=new THREE.DragControls(o,d,s.domElement),w.addEventListener("hoveron",function(e){u.enabled=!1}),w.addEventListener("hoveroff",function(e){u.enabled=!0}),w.addEventListener("dragstart",function(e){e.object.material.emissive.set(11184810),R=e.object,window.addEventListener("wheel",P,!1)}),w.addEventListener("dragend",function(e){e.object.material.emissive.set(0),window.removeEventListener("wheel",P,!1)})}function K(e){var e=6.8;T=new THREE.Vector3(50,20,50);var t=new THREE.Vector3(-e/2,10,-6),a=new THREE.Vector3(+e/2,10,-6);E=new THREE.Scene;var n=new THREE.SphereGeometry(10,32,22),c=new THREE.MeshPhongMaterial({color:11184810}),r=new THREE.Mesh(n,c);r.name="Head",r.position.set(T.x,T.y,T.z),E.add(r);var n=new THREE.SphereGeometry(3,32,22),c=new THREE.MeshPhongMaterial({color:16711680}),i=new THREE.Mesh(n,c);i.name="EyeL",i.position.set(t.x,t.y,t.z),r.add(i);var n=new THREE.SphereGeometry(3,32,22),c=new THREE.MeshPhongMaterial({color:255}),i=new THREE.Mesh(n,c);i.name="EyeR",i.position.set(a.x,a.y,a.z),r.add(i),b(E)}function W(o,e){u=new THREE.OrbitControls(o,e.domElement),u.minDistance=120,u.maxDistance=5e4}function b(o){var e=new THREE.AmbientLight(8947848,.4);o.add(e);var t=new THREE.PointLight(16777215,.8);t.position.z+=200,o.add(t)}function A(){m=new THREE.Scene;var o=new THREE.TeapotGeometry(40,15),e=new THREE.MeshPhongMaterial({color:16777215}),t=new THREE.Mesh(o,e);t.name="Teapot",t.position.z-=70,m.add(t);var a=new THREE.TorusGeometry(10,3,15,100),r=new THREE.MeshPhongMaterial({color:16777215}),n=new THREE.Mesh(a,r);n.name="Torus",n.position.z-=-75,m.add(n),b(m)}function _(){p=new THREE.Scene;for(var[o,e]of l.entries()){var t=e.origin,a=e.u,r=e.v,n=new THREE.BoxGeometry(a.length(),r.length(),.01),c=new THREE.MeshPhongMaterial({map:y[o].texture}),i=new THREE.Mesh(n,c);i.name=e.name,e.name=="Left"&&(i.rotation.y=Math.PI/2),e.name=="Right"&&(i.rotation.y=-Math.PI/2),e.name=="Floor"&&(i.rotation.x=Math.PI/2,i.rotation.z=Math.PI);var v=a.clone().multiplyScalar(.5),H=r.clone().multiplyScalar(.5),f=new THREE.Vector3().addVectors(t,v);f.add(H),i.position.set(f.x,f.y,f.z),p.add(i)}b(p)}function Y(){y=[];for(var e of l)y.push(new THREE.WebGLRenderTarget(1024,1024))}function Z(){d=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e4),d.position.set(100,100,300),d.lookAt(0,0,0)}function q(){l=[];var o=new g("Front",new THREE.Vector3(-150,-150,-150),new THREE.Vector3(300,0,0),new THREE.Vector3(0,300,0));l.push(o);var e=new g("Left",new THREE.Vector3(-150,-150,150),new THREE.Vector3(0,0,-300),new THREE.Vector3(0,300,0));l.push(e);var t=new g("Right",new THREE.Vector3(150,-150,-150),new THREE.Vector3(0,0,300),new THREE.Vector3(0,300,0));l.push(t);var a=new g("Floor",new THREE.Vector3(-150,-150,150),new THREE.Vector3(300,0,0),new THREE.Vector3(0,0,-300));l.push(a)}function S(){var o=E.getObjectByName("EyeL");return o.getWorldPosition(new THREE.Vector3)}function j(){var o=E.getObjectByName("EyeR");return o.getWorldPosition(new THREE.Vector3)}function V(o,e){var t=d.clone(),a=new THREE.Matrix4;return a.copy(o).invert(),t.position.set(a.elements[12],a.elements[13],a.elements[14]),t.setRotationFromMatrix(o),t.projectionMatrix=e.clone(),t}function L(){var o=s.getContext(),e=s.xr.enabled;s.xr.enabled=!1,s.setClearColor(8421504),s.clear(),M&&s.render(m,d);for(let[i,v]of l.entries()){s.setRenderTarget(y[i]),s.setClearColor(4210752),s.clear(),o.colorMask(1,0,0,0);var a=S(),r=v.viewMatrix(a),n=v.projectionMatrix(a,1,1e4),t=V(r,n);s.render(m,t),o.colorMask(0,1,1,0);var a=j(),r=v.viewMatrix(a),n=v.projectionMatrix(a,1,1e4),c=V(r,n);s.clearDepth(),s.render(m,c),o.colorMask(1,1,1,0)}s.xr.enabled=e,s.setRenderTarget(null),s.setClearColor(0),s.render(p,d),s.render(E,d)}function J(o){var e=E.getObjectByName("Head"),t=E.getObjectByName("EyeL"),a=E.getObjectByName("EyeR");e.position,t.position.x-=o/2,a.position.x+=o/2}function Q(o){var e=E.getObjectByName("Head"),t=E.getObjectByName("EyeL"),a=E.getObjectByName("EyeR");e.position,t.position.x+=o/2,a.position.x-=o/2}window.addEventListener("keydown",function(o){switch(o.code){case"KeyL":var e=S();d.position.set(e.x,e.y,e.z);break;case"KeyR":var e=j();d.position.set(e.x,e.y,e.z);break;case"KeyS":M=!M;break;case"KeyT":var t=l[0].viewMatrix(new THREE.Vector3(50,20,100)),r=l[1].viewMatrix(new THREE.Vector3(50,20,100)),n=l[2].viewMatrix(new THREE.Vector3(50,20,100));console.log("View matrices:"),console.log(t),console.log(r),console.log(n);var a=l[0].projectionMatrix(new THREE.Vector3(0,0,0),1,1e3),r=l[1].viewMatrix(new THREE.Vector3(50,20,100)),n=l[2].viewMatrix(new THREE.Vector3(50,20,100));console.log("Projection matrices:"),console.log(a),console.log(r),console.log(n);break;case"KeyI":J(8);break;case"KeyO":Q(8);break}});G();
